<% layout('boilerplate') %>

<h4><%= product.name %></h4>
<h6><%= product.price %></h6>
<h6><%= product.category %></h6>
<p><%= product.description %></p>
<% if(currentUser && currentUser.admin === true) { %>
    <a href="<%=product.id%>/edit" class="btn btn-primary">Edit Post</a>
    <form action="/products/<%=product.id%>?_method=DELETE" method="POST">
        <button class="btn btn-danger">Delete</button>
    </form>

<% } %>

<h4>Reviews</h4>




<h5>Leave a review</h5>



<% if(currentUser) { %>
    <form action="/products/<%= product.id %>/reviews" method="POST" class="needs-validation" novalidate>
        <label class="form-label" for="rating">Rating</label>
        <input type="text" class="form-control" id="rating" name="review[rating]">
        <label class="form-label" for="content">Review</label>
        <textarea class="form-control" id="body" name="review[body]" rows="4" required></textarea>
    
        <button class="btn btn-success">Submit Review</button>
    </form>

<% } %>

<%for(let review of product.reviews) { %>
    <p>Rating: <%=review.rating%> </p>
    <p>Review: <%=review.body%> </p>
    <p>Author: <%=review.author.username%> </p>

    <% if (currentUser && review.author.equals(currentUser._id)) { %>
        <form action="/products/<%=product._id%>/reviews/<%=review._id%>?_method=DELETE" method="POST">
            <button class="btn btn-danger">DELETE</button>
        </form>
    <% } %>
<% } %>

